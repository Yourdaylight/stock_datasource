# 规格说明: 智能选股模块

## 数据访问原则

**重要**: 所有数据访问必须优先使用 `plugins/` 目录下的 Plugin Services。

可用的 Plugin Services：
- `TuShareDailyBasicService` - PE/PB/换手率等估值指标
- `TuShareStockBasicService` - 股票基本信息/行业/上市状态
- `TuShareDailyService` - 日线行情数据
- `TuShareFinaceIndicatorService` - 财务指标数据
- `TuShareAdjFactorService` - 复权因子

仅当 Plugin Services 无法满足需求时，才允许自定义 SQL 查询。

## ADDED Requirements

### Requirement: 多维度条件筛选
系统 SHALL 提供多维度股票筛选能力，允许用户基于估值、技术、量能、行业等维度筛选股票。

#### Scenario: 按估值指标筛选
- **假设** 用户想找低估值股票
- **当** 用户设置条件: PE < 20, PB < 3, 股息率 > 2%
- **则** 系统返回满足所有条件的股票
- **且** 结果按指定字段排序（默认: 涨跌幅降序）
- **且** 结果包含分页信息（total, page, page_size）

#### Scenario: 按技术指标筛选
- **假设** 用户想找技术面看多的股票
- **当** 用户设置条件: 价格站上MA20, MACD金叉
- **则** 系统计算所有股票的技术指标
- **且** 返回满足技术条件的股票

#### Scenario: 按行业筛选
- **假设** 用户想找特定行业的股票
- **当** 用户选择行业: ["电子", "计算机", "通信"]
- **则** 系统返回属于所选行业的股票
- **且** 行业筛选可与其他条件组合使用

#### Scenario: 无效字段拒绝
- **假设** 用户尝试使用不存在的字段筛选
- **当** 用户设置条件字段为 "invalid_field"
- **则** 系统拒绝请求并返回错误信息
- **且** 返回有效字段列表

---

### Requirement: 股票十维画像
系统 SHALL 为每只股票计算并提供十维画像，每个维度评分 0-100。

#### Scenario: 获取单只股票画像
- **假设** 用户想分析特定股票
- **当** 用户请求股票代码 "600519.SH" 的画像
- **则** 系统返回包含10个维度评分的画像:
  - 估值维度: PE/PB 百分位排名
  - 成长维度: 营收/利润增长率
  - 盈利维度: ROE、毛利率
  - 动量维度: 近期价格表现
  - 趋势维度: 均线排列、MACD状态
  - 量能维度: 换手率、量比
  - 波动维度: 价格波动率、ATR
  - 资金维度: 主力资金流向
  - 情绪维度: 涨停次数、龙虎榜
  - 风险维度: ST风险、停牌风险
- **且** 返回加权综合评分
- **且** 返回投资建议文本

#### Scenario: 批量画像计算
- **假设** 用户想比较多只股票
- **当** 用户请求多个股票代码的画像
- **则** 系统返回所有请求股票的画像
- **且** 支持批量计算以提升性能

#### Scenario: 数据缺失处理
- **假设** 部分维度数据不可用（如无财报数据）
- **当** 用户请求画像
- **则** 系统计算可用维度
- **且** 将不可用维度标记为 "N/A"
- **且** 相应调整综合评分计算

---

### Requirement: 自然语言选股
系统 SHALL 支持自然语言查询选股，将用户意图解析为结构化筛选条件。

#### Scenario: 简单自然语言查询
- **假设** 用户想用自然语言选股
- **当** 用户输入 "找出市盈率低于20的股票"
- **则** 系统解析为条件: {field: "pe_ttm", operator: "lt", value: 20}
- **且** 执行筛选
- **且** 返回匹配股票并解释解析的条件

#### Scenario: 复杂自然语言查询
- **假设** 用户输入复杂需求
- **当** 用户输入 "找出低估值高成长的科技股"
- **则** 系统解析为多个条件:
  - PE < 20（低估值）
  - 营收增速 > 20%（高成长）
  - 行业 in ["电子", "计算机", "通信"]（科技股）
- **且** 返回匹配股票
- **且** 解释解析逻辑

#### Scenario: 模糊查询澄清
- **假设** 用户输入模糊
- **当** 用户输入 "找好股票"
- **则** 系统返回澄清请求
- **或** 使用默认的"优质股"标准
- **且** 解释解读方式

---

### Requirement: AI 智能推荐
系统 SHALL 基于市场状态和预设策略提供 AI 驱动的股票推荐。

#### Scenario: 获取每日推荐
- **假设** 用户想要 AI 推荐
- **当** 用户请求每日推荐
- **则** 系统返回分类推荐:
  - 低估值精选
  - 高成长潜力
  - 技术突破
  - 热门关注
- **且** 每个推荐包含理由和评分

#### Scenario: 获取技术信号股
- **假设** 用户想找有特定技术信号的股票
- **当** 用户请求技术信号
- **则** 系统返回有以下信号的股票:
  - MACD金叉
  - 均线多头排列
  - 放量突破
  - RSI超卖反弹
- **且** 包含信号强度指标

---

### Requirement: 预设筛选策略
系统 SHALL 提供增强的预设筛选策略，用户可一键应用。

#### Scenario: 应用预设策略
- **假设** 系统已定义预设策略
- **当** 用户选择 "低估值策略"
- **则** 系统应用条件: PE < 15, PB < 2, 股息率 > 2%
- **且** 返回匹配股票

#### Scenario: 列出可用预设
- **假设** 用户想查看可用策略
- **当** 用户请求预设列表
- **则** 系统返回预设信息:
  - id、名称、描述
  - 条件列表
  - 预期结果数量（可选）

#### Scenario: 预设策略列表
- **假设** 系统提供多种预设策略
- **则** 可用预设应包括:
  - 低估值策略: PE < 15, PB < 2
  - 高成长策略: 营收增速 > 20%, 利润增速 > 30%
  - 动量策略: 5日涨幅 > 10%, 量比 > 1.5
  - 价值投资策略: ROE > 15%, PE < 20
  - 技术突破策略: 价格站上MA20, MACD金叉
  - 龙头股策略: 行业龙头, 市值 > 500亿

---

### Requirement: 行业板块筛选
系统 SHALL 支持按行业和板块分类筛选股票。

#### Scenario: 获取行业列表
- **假设** 用户想按行业筛选
- **当** 用户请求行业列表
- **则** 系统返回所有可用行业
- **且** 包含每个行业的股票数量

#### Scenario: 按行业筛选股票
- **假设** 用户选择特定行业
- **当** 用户请求 "白酒" 行业的股票
- **则** 系统返回该行业的所有股票
- **且** 支持分页和排序

#### Scenario: 多行业筛选
- **假设** 用户想从多个行业选股
- **当** 用户选择 ["电子", "计算机", "通信"]
- **则** 系统返回属于任一所选行业的股票
- **且** 可与其他筛选条件组合

---

### Requirement: 筛选结果操作
系统 SHALL 允许用户对筛选结果执行操作。

#### Scenario: 查看股票详情
- **假设** 用户看到筛选结果
- **当** 用户点击某只股票
- **则** 系统显示股票详情对话框
- **且** 包含价格走势图、画像和关键指标

#### Scenario: 添加自选
- **假设** 用户在结果中发现感兴趣的股票
- **当** 用户点击 "加自选" 按钮
- **则** 系统将股票添加到用户的持仓/自选列表
- **且** 显示成功确认

#### Scenario: 导出结果
- **假设** 用户想保存筛选结果
- **当** 用户点击导出按钮
- **则** 系统将结果导出为 CSV/Excel 格式
- **且** 包含所有可见列

---

## MODIFIED Requirements

### Requirement: 股票列表展示
系统 SHALL 以增强的信息和更好的用户体验展示股票列表。

#### Scenario: 分页展示股票列表
- **假设** 用户打开选股页面
- **当** 页面加载
- **则** 系统展示股票列表，包含:
  - **股票代码 (ts_code) 和股票名称 (name)** - 必须同时显示
  - 交易日期
  - 价格信息: 收盘价、涨跌幅（带颜色标识）
  - 估值指标: PE、PB、市值
  - 量能指标: 换手率、成交量
- **且** 支持分页（默认每页20条）
- **且** 支持按任意列排序

#### Scenario: 展示市场概况
- **假设** 用户打开选股页面
- **当** 页面加载
- **则** 系统展示市场概况:
  - 交易日期
  - 股票总数
  - 上涨/下跌/平盘数量
  - 涨停/跌停数量
  - 平均涨跌幅

#### Scenario: 搜索股票
- **假设** 用户想找特定股票
- **当** 用户在搜索框输入股票代码
- **则** 系统按代码筛选股票（支持模糊匹配）
- **且** 立即更新结果列表
